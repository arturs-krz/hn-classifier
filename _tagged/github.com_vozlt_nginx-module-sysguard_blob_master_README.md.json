{
	"_id": "14338708",
	"site": "https://github.com/vozlt/nginx-module-sysguard/blob/master/README.md",
	"title": " Nginx Sysguard â€“ throttle requests by load, average request time, etc.",
	"author": "vozlt",
	"date": "2017-06-13T13:08:16.189Z",
	"tags": {
		"categories": [
			"opensource"
		],
		"languages": []
	},
	"content": "nginx sysguard modulenginx sysguard moduletable contentsversiondependenciescompatibilityinstallationsynopsisdescriptionembedded variablesdirectivessysguardsysguard_loadsysguard_memsysguard_rtsysguard_modesysguard_intervalsysguard_log_level alsotododonationauthorversion document describes nginx-module-sysguard v0.1.0 released 23 feb 2017.dependenciesnginxsysinfo(2) | getloadavg(3)/proc/meminfocompatibility1.11.x (last tested: 1.11.10)earlier versions is tested.installationclone git repository.shell> git clone git://github.com/vozlt/nginx-module-sysguard.gitadd module the build configuration adding--add-module=/path//nginx-module-sysguardbuild nginx binary.install nginx binary.synopsishttp { ... server { ... sysguard ; sysguard_mode ; sysguard_load load=10.5 action=/loadlimit; sysguard_mem swapratio=20% action=/swaplimit; sysguard_mem free=100m action=/freelimit; sysguard_rt rt=0.01 period=5s method=amm:10 action=/rtlimit; location /loadlimit { return 503; } location /swaplimit { return 503; } location /freelimit { return 503; } location /rtlimit { return 503; } } ... server { ... location /api { sysguard ; sysguard_mode ; sysguard_load load=20 action=/limit; sysguard_mem swapratio=10% action=/limit; sysguard_rt rt=2.01 period=5s method=wma:10 action=/limit; ... } location /images { sysguard ; sysguard_mode ; sysguard_load load=20 action=/limit; sysguard_mem swapratio=10% action=/limit; sysguard_rt rt=2.01 period=5s method=wma:10 action=/limit; ... } location /limit { return 503; } }}description module be used protect server case system load, memory goes too high requests are responded too slow. is porting version the sysguard tengine the pure nginx as support same features.caveats: note module requires sysinfo(2) system call, getloadavg(3) function glibc. also requires /proc file system get memory information.embedded variables following embedded variables are provided:$sysguard_load load system. $sysguard_load's value is 100, load is 0.1(100/1000). (/msec)$sysguard_swapstat ratio using swap. (/per)$sysguard_free real free space memory. (/byte)$sysguard_rt average request processing times. $sysguard_rt's value is 100, response is 0.1sec(100/1000). (/msec)$sysguard_meminfo_totalram total memory meminfo. (/byte)$sysguard_meminfo_freeram free memory meminfo. (/byte)$sysguard_meminfo_bufferram buffer memory meminfo. (/byte)$sysguard_meminfo_cachedram cached memory meminfo. (/byte)$sysguard_meminfo_totalswap total swap meminfo. (/byte)$sysguard_meminfo_freeswap free swap meminfo. (/byte)directivessysguard--syntaxsysguard <|off>defaultoffcontexthttp, server, locationdescription: enables disables module working.sysguard_load--syntaxsysguard_load load=number [action=/url]default-contexthttp, server, locationdescription: specify load threshold. the system load exceeds threshold, subsequent requests be redirected the url specified the 'action' parameter. will return 503 there's 'action' url defined. directive support using ncpuratio instead the fixed threshold, 'ncpu' means number cpu's cores, can this directive this: load=ncpu1.5sysguard_mem--syntaxsysguard_mem swapratio=ratio% free=size [action=/url]default-contexthttp, server, locationdescription: specify used swap memory free memory threshold. the swap memory ratio exceeds threshold memory free less the size, subsequent requests be redirected the url specified the 'action' parameter. will return 503 there's 'action' url. sysguard uses strategy calculate memory free: \"memfree = free + buffered + cached\"sysguard_rt--syntaxsysguard_rt rt=second period= [method=<amm|wma>:number] [action=/url]default-contexthttp, server, locationdescription: specify response threshold.parameter rt is used set threshold the average response , in second.parameter period is used specifiy period the statistics cycle. the average response of system exceeds threshold specified the user, incoming request be redirected a specified url is defined parameter 'action'. no 'action' is presented, request be responsed 503 error directly. method is formula calculate average response processing times. number method is number samples calculate average. default method is set be method=amm:period.amm amm is arithmetic mean.wma wma is weighted moving average.sysguard_mode--syntaxsysguard_mode <|or>defaultcontexthttp, server, locationdescription: there are more one type monitor, directive is used specified relations among the monitors are: '' for matching 'or' any matching.sysguard_interval--syntaxsysguard_interval default1scontexthttp, server, locationdescription: specify time interval update system information. default value is second, means sysguard updates server status once second.sysguard_log_level--syntaxsysguard_log_level <info|notice|warn|error>defaulterrorcontexthttp, server, locationdescription: specify log level sysguard. alsonginx-module-vtsnginx-module-ststododonationauthorcopyright (c) 2010-2015 alibaba group holding limitedcopyright (c) 2017, youngjoo.kim <vozltx@gmail.com>"
}