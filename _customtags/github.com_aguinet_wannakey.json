{
	"_id": "14374606",
	"site": "https://github.com/aguinet/wannakey",
	"title": "WannaCry in-memory key recovery for Windows XP",
	"author": "uladzislau",
	"date": "2017-06-13T13:57:07.670Z",
	"tags": {
		"categories": [
			"tools", "security"
		],
		"languages": [
			"c++",
			"cmake"
		]
	},
	"content": "readme.rst wannakeywarning software has been tested known work under windows xp, 7 x86,2003, vista windows server 2008 (tests @msuiche).please note you need luck this work ( below), so might work every case!disclamer code is will always gplv3. license file attached.updatesv2.1optimization the prime search process ( https://github.com/aguinet/wannakey/issues/2).openmp version uses many core available speed- the processtool finds whether wannakey's technique has chances work a running windows osv2.0automatically find encryption process pidwrite private key that original malware's process decrypt files (using decrypt button)code refactoring cmake usagev0.2 generated private rsa key had invalid computed fields, made key importable cryptimportkey under windows xp (fixed). wanafork /or wanadecrypt now used directly xp.updated binary this fix a static build ( need the msvcruntime anymore)v0.1original versionintroduction software allows recover prime numbers the rsa private key are used wanacry. does by searching them the wcry.exe process. is process generates rsa private key. main issue is thecryptdestroykey cryptreleasecontext does erase primenumbers memory before freeing associated memory. is really mistake the ransomware authors, they properly the windows crypto api. indeed, what 've tested, under windows 10,cryptreleasecontext does cleanup memory ( so recovery techniquewon't ). it work under windows xp , in version,cryptreleasecontext does do cleanup. moreover, msdn states ,for function : \" this function is called, released csp handle is longer valid. function does destroy key containers key pairs.\"., it seems there are clean cross-platform ways under windows clean memory. you are lucky ( is associated memory hasn't been reallocated erased), prime numbers might still in memory.'s this software tries achieve.usage can the binary wannakey.exe the bin/ folder. will locate encryption pid itself. it 't, might need search by hand pass as argument the wannakey.exe tool. you multiple cores, can the wannakey_omp.exe binary. youdon't the vcomp140.dll your system, can copy alongsidewannakey_omp.exe version is present the bin directory(extracted the msvc 2015 c++ runtime). unfortunately, doesn't seemstraightforward statically link this library. the key had been succeesfully generated, will need use \"decrypt\" button the malware decrypt files!windows crytp api leak check tool named \"winapi_check\" ( the bin/ directory) checks whether windowscrypto api remove private key's primes memory not. allows verify wannakey has small chance not work.please note , even this tool says wannakey stands chance, doesn't mean will !if have tried tool, please report results here: https://github.com/aguinet/wannakey/issues/5.compile source need least visual studio 2015 express cmake.launch vs2015 native tools command line prompt run:> cd /path//wannakey/wannakey/> mkdir build> cd build> cmake -g \"visual studio 14 2015\" -t \"v140_xp\" ..> cmake --build . --config \"release\"binary be the src/release directory.credits@wiskitki spotted cryptreleasecontext issue windows 10 ( actually wipe primes memory).@hackerfantastic releasing sample usedmiasm (https://github.com/cea-sec/miasm) its help extracting dll reversing whole thingwine sources the windows rsa private key format."
}